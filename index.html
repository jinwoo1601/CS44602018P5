<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<script type="text/javascript" src="d3.js"></script>	  
	</head>
	<body>
		<script>
			var dataTree = {
				"name": "data",
				"ratings": [
					{
						"name": "PG-13",
						"genres": []
					},
					{
						"name": "R",
						"genres": []
					},
					{
						"name": "PG",
						"genres": []
					},
					{
						"name": "G",
						"genres": []
					},
					{
						"name": "Unrated",
						"genres": []
					},
					{
						"name": "NC-17",
						"genres": []
					},
					{
						"name": "TV-MA",
						"genres": []
					},
					{
						"name": "TV-14",
						"genres": []
					},
					{
						"name": "Not Listed",
						"genres": []
					},
					{
						"name": "Not Rated",
						"genres": []
					}
				]
			};

			var ratings = ["PG-13", "R", "PG", "G", "Unrated", "NC-17", "TV-MA", "TV-14", "Not Rated", "Not Listed"];

			d3.csv("movies.csv", function(csv) {
				for (var i=0; i<csv.length; ++i) {
					csv[i].gross = Number(csv[i].gross);
					var movieObj = {
								"name": csv[i].genres,
								"gross": csv[i].gross
							};
					var pushCheck=1;
					switch (csv[i].content_rating) {
						case ratings[0]:
							if (dataTree.ratings[0].genres.length == 0) {
								dataTree.ratings[0].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[0].genres.length; k++) {
									if (dataTree.ratings[0].genres[k].name == csv[i].genres) {
										dataTree.ratings[0].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[0].genres.push(movieObj);
								}
							}
							break;
						case ratings[1]:
							if (dataTree.ratings[1].genres.length == 0) {
								dataTree.ratings[1].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[1].genres.length; k++) {
									if (dataTree.ratings[1].genres[k].name == csv[i].genres) {
										dataTree.ratings[1].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[1].genres.push(movieObj);
								}
							}
							break;
						case ratings[2]:
							if (dataTree.ratings[2].genres.length == 0) {
								dataTree.ratings[2].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[2].genres.length; k++) {
									if (dataTree.ratings[2].genres[k].name == csv[i].genres) {
										dataTree.ratings[2].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[2].genres.push(movieObj);
								}
							}
							break;
						case ratings[3]:
							if (dataTree.ratings[3].genres.length == 0) {
								dataTree.ratings[3].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[3].genres.length; k++) {
									if (dataTree.ratings[3].genres[k].name == csv[i].genres) {
										dataTree.ratings[3].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[3].genres.push(movieObj);
								}
							}
							break;
						case ratings[4]:
							if (dataTree.ratings[4].genres.length == 0) {
								dataTree.ratings[4].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[4].genres.length; k++) {
									if (dataTree.ratings[4].genres[k].name == csv[i].genres) {
										dataTree.ratings[4].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[4].genres.push(movieObj);
								}
							}
							break;
						case ratings[5]:
							if (dataTree.ratings[5].genres.length == 0) {
								dataTree.ratings[5].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[5].genres.length; k++) {
									if (dataTree.ratings[5].genres[k].name == csv[i].genres) {
										dataTree.ratings[5].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[5].genres.push(movieObj);
								}
							}
							break;
						case ratings[6]:
							if (dataTree.ratings[6].genres.length == 0) {
								dataTree.ratings[6].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[6].genres.length; k++) {
									if (dataTree.ratings[6].genres[k].name == csv[i].genres) {
										dataTree.ratings[6].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[6].genres.push(movieObj);
								}
							}
							break;
						case ratings[7]:
							if (dataTree.ratings[7].genres.length == 0) {
								dataTree.ratings[7].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[7].genres.length; k++) {
									if (dataTree.ratings[7].genres[k].name == csv[i].genres) {
										dataTree.ratings[7].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[7].genres.push(movieObj);
								}
							}
							break;
						case ratings[8]:
							if (dataTree.ratings[8].genres.length == 0) {
								dataTree.ratings[8].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[8].genres.length; k++) {
									if (dataTree.ratings[8].genres[k].name == csv[i].genres) {
										dataTree.ratings[8].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[8].genres.push(movieObj);
								}
							}
							break;
						case ratings[9]:
							if (dataTree.ratings[9].genres.length == 0) {
								dataTree.ratings[9].genres.push(movieObj);
							} else {
								for (var k=0; k<dataTree.ratings[9].genres.length; k++) {
									if (dataTree.ratings[9].genres[k].name == csv[i].genres) {
										dataTree.ratings[9].genres[k].gross += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.ratings[9].genres.push(movieObj);
								}
							}
							break;
					}
				}
				console.log(dataTree);
			});
		</script>
	</body>
</html>
