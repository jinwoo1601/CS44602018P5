<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<script src="http://d3js.org/d3.v4.min.js"></script>	  
	</head>
	
	<style>
		#content {
		  width: 850px;
		  height: 680px;
		}
		/* rect {
		  fill: darkblue;
		  opacity: 0.3;
		  stroke: white;
		} */
		text {
		  font-family: "Helvetica Neue", Helvetica, sans-serif;
		  font-size: 12px;
		}
		g text {
		  fill: white;
		  font-size: 10px;
		}
	</style>
	<body>
		<h1>Treemap of Gross Revenue of Movies by Content rating</h1>
		<div id="content"></div>
		<div id="textarea">
				<strong>Gross Revenue:</strong> <span id="grossR"></span><br/>
		</div>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
		<script>

			var ratings = ["PG-13", "R", "PG", "G", "Unrated", "NC-17", "TV-MA", "Not Listed"];
			var ratingsGross = [0, 0, 0, 0, 0, 0, 0, 0];
			var color = d3.scaleOrdinal().range(d3.schemeCategory10)

			var dataTree = {
				"name": "Total Gross Revenue",
				"children": [
					{
						"name": "PG-13",
						"value": 33850049614
					},
					{
						"name": "R",
						"value": 15684997614
					},
					{
						"name": "PG",
						"value": 15077401596
					},
					{
						"name": "G",
						"value": 1540370967
					},
					{
						"name": "Unrated",
						"value": 1009472
					},
					{
						"name": "NC-17",
						"value": 4000304
					},
					{
						"name": "TV-MA",
						"value": 894186
					}
				]
			}

			d3.csv("movies.csv", function(csv) {
				for (var i=0; i < csv.length; ++i) {
					csv[i].gross = Number(csv[i].gross);
					switch (csv[i].content_rating) {
						case ratings[0]:
							ratingsGross[0] += csv[i].gross;
							break;
						case ratings[1]:
							ratingsGross[1] += csv[i].gross;
							break;
						case ratings[2]:
							ratingsGross[2] += csv[i].gross;
							break;
						case ratings[3]:
							ratingsGross[3] += csv[i].gross;
							break;
						case ratings[4]:
							ratingsGross[4] += csv[i].gross;
							break;
						case ratings[5]:
							ratingsGross[5] += csv[i].gross;
							break;
						case ratings[6]:
							ratingsGross[6] += csv[i].gross;
							break;
						case ratings[7]:
							ratingsGross[7] += csv[i].gross;
							break;
					}
				}
			});
			var width = 1400, height = 800;

			var ratios = [1];

			var treemapLayout = d3.treemap()
				.size([1400, 700])
				.paddingOuter(16);

			var rootNode = d3.hierarchy(dataTree)
			rootNode.sum(function(d) {
				return d.value;
			});

			function enteringTreemap(d) {

				treemapLayout.tile(d3.treemapSquarify.ratio(d))
				treemapLayout(rootNode);

				d3.select(this)
					.append('text')
					// .text(function(d) {return 'Ratio = ' + d})
					.attr('dy', 14)

				var nodes = d3.select(this)
					.append('g')
					.attr('transform', 'translate(0, 20)')
					.selectAll('g')
					.data(rootNode.descendants())
					.enter()
					.append('g')
					.attr('transform', function(d) {return 'translate(' + [d.x0, d.y0] + ')'})

				nodes
					.append('rect')
					.attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
					.attr('width', function(d) { return d.x1 - d.x0; })
					.attr('height', function(d) { return d.y1 - d.y0; })
					.on("mouseover", function(d) {
						document.getElementById("grossR").textContent=d.value;
					})

				nodes
					.append('text')
					.attr('dx', 4)
					.attr('dy', 14)
					.text(function(d) {
						return d.data.name;
					})
			}

			var treemaps = d3.select('#content')
			.selectAll('svg')
			.data(ratios)
			.enter()
			.append('svg')
			.attr('width', width + 'px')
			.attr('height', height + 'px')
			.each(enteringTreemap)
			

			// console.log(dataTree.sum(function(d) {return d.gross;}));
		</script>
	</body>
</html>
