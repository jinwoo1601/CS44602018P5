<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<script src="http://d3js.org/d3.v4.min.js"></script>	  
	</head>
	<body>
		<script>
			var dataTree = {
				"name": "data",
				"children": [
					{
						"name": "PG-13",
						"children": []
					},
					{
						"name": "R",
						"children": []
					},
					{
						"name": "PG",
						"children": []
					},
					{
						"name": "G",
						"children": []
					},
					{
						"name": "Unrated",
						"children": []
					},
					{
						"name": "NC-17",
						"children": []
					},
					{
						"name": "TV-MA",
						"children": []
					},
					{
						"name": "TV-14",
						"children": []
					},
					{
						"name": "Not Listed",
						"children": []
					},
					{
						"name": "Not Rated",
						"children": []
					}
				]
			};

			var ratings = ["PG-13", "R", "PG", "G", "Unrated", "NC-17", "TV-MA", "TV-14", "Not Rated", "Not Listed"];

			d3.csv("movies.csv", function(csv) {
				for (var i=0; i<csv.length; ++i) {
					csv[i].gross = Number(csv[i].gross);
					var movieObj = {
								"name": csv[i].genres,
								"value": csv[i].gross
							};
					var pushCheck=1;
					switch (csv[i].content_rating) {
						case ratings[0]:
							if (dataTree.children[0].children.length == 0) {
								dataTree.children[0].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[0].children.length; k++) {
									if (dataTree.children[0].children[k].name == csv[i].genres) {
										dataTree.children[0].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[0].children.push(movieObj);
								}
							}
							break;
						case ratings[1]:
							if (dataTree.children[1].children.length == 0) {
								dataTree.children[1].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[1].children.length; k++) {
									if (dataTree.children[1].children[k].name == csv[i].genres) {
										dataTree.children[1].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[1].children.push(movieObj);
								}
							}
							break;
						case ratings[2]:
							if (dataTree.children[2].children.length == 0) {
								dataTree.children[2].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[2].children.length; k++) {
									if (dataTree.children[2].children[k].name == csv[i].genres) {
										dataTree.children[2].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[2].children.push(movieObj);
								}
							}
							break;
						case ratings[3]:
							if (dataTree.children[3].children.length == 0) {
								dataTree.children[3].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[3].children.length; k++) {
									if (dataTree.children[3].children[k].name == csv[i].genres) {
										dataTree.children[3].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[3].children.push(movieObj);
								}
							}
							break;
						case ratings[4]:
							if (dataTree.children[4].children.length == 0) {
								dataTree.children[4].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[4].children.length; k++) {
									if (dataTree.children[4].children[k].name == csv[i].genres) {
										dataTree.children[4].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[4].children.push(movieObj);
								}
							}
							break;
						case ratings[5]:
							if (dataTree.children[5].children.length == 0) {
								dataTree.children[5].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[5].children.length; k++) {
									if (dataTree.children[5].children[k].name == csv[i].genres) {
										dataTree.children[5].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[5].children.push(movieObj);
								}
							}
							break;
						case ratings[6]:
							if (dataTree.children[6].children.length == 0) {
								dataTree.children[6].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[6].children.length; k++) {
									if (dataTree.children[6].children[k].name == csv[i].genres) {
										dataTree.children[6].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[6].children.push(movieObj);
								}
							}
							break;
						case ratings[7]:
							if (dataTree.children[7].children.length == 0) {
								dataTree.children[7].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[7].children.length; k++) {
									if (dataTree.children[7].children[k].name == csv[i].genres) {
										dataTree.children[7].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[7].children.push(movieObj);
								}
							}
							break;
						case ratings[8]:
							if (dataTree.children[8].children.length == 0) {
								dataTree.children[8].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[8].children.length; k++) {
									if (dataTree.children[8].children[k].name == csv[i].genres) {
										dataTree.children[8].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[8].children.push(movieObj);
								}
							}
							break;
						case ratings[9]:
							if (dataTree.children[9].children.length == 0) {
								dataTree.children[9].children.push(movieObj);
							} else {
								for (var k=0; k<dataTree.children[9].children.length; k++) {
									if (dataTree.children[9].children[k].name == csv[i].genres) {
										dataTree.children[9].children[k].value += csv[i].gross;
										pushCheck=0;
										break;
									}
								}
								if (pushCheck) {
									dataTree.children[0].children.push(movieObj);
								}
							}
							break;
					}
				}
			});
			console.log(dataTree);
			var root = d3.hierarchy(dataTree);
			root.sum(function(d) {return d.value;})
			console.log(root);
			// var treemap = d3.treemap(root);
			// console.log(treemap);
			// console.log(dataTree.sum(function(d) {return d.gross;}));
		</script>
	</body>
</html>
